Generemos un plugin  para woocommerce para vender tarjetas solidarias y coronas de caridad para una fundación llamada "Hogar Italiano". El producto "saludos-solidarios" permite generar una tarjeta de saludo para diferentes ocasiones, que, al realizar una donación determinada, envía un correo electrónico con una tarjeta virtual (es un producto virtual de Wocoommerce) (más adelante la verás en un diseño que se encuentra dentro de un DIV de html llamado higift_view). El producto "corona-de-caridad" es lo mismo, pero con unos textos distintos y además permite utilizar métodos de envío (es un producto físico)

-----------
WOOCOMMECE BACKEND: Pestaña "HI Gift"

Los templates son activados para ese producto, si dentro del editor de producto, en esta pestaña, el usuario marca uno de los dos radiobuttons siguientes:

- Tarjeta solidaria
- Corona de Caridad

Solo puede marcar uno de los dos radiobuttons.Cuando el usuario pincha uno de los dos radiobuttons, aparece abajo un texto que dice "limpiar", que permite deseleccionar.

Estas opciones hacen que se active uno de los dos templates que describiré más adelante.

Cada uno de los productos permite configurar 3 mensajes personalizados, que corresponden con 3 cajas de texto que se encuentran en la misma pestaña que creamos anteriormente ("HI Gift"), y que se muestran (javascript quizá?) solo cuando un usuario selecciona uno de los dos radiobuttons "corona" o "tarjeta" que describimos arriba.

------------
FRONTEND Y TEMPLATES:
El plugin contiene dos templates: single-product-tarjeta-solidaria.php y single-product-corona-de-caridad.php. 
Estos templates sobreescriben el single-product.php por defecto de woocommerce cuando se activan.

Ambos templates están compuestos de dos columnas, siguiendo esta estructura básica: 

COLUMNA IZQUIERDA (configurador de tarjeta)

En la columna izquierda (llamada con nombre id "higift-left"), hay un div contenedor (llamado "higift-left-container" con un formulario, que contiene una serie de campos que corresponden con una lista de campos personalizados, los que se deben guardar al presionar el botón "añadir al carrito", para posteriormente convertirse en líneas de información en el pedido, los cuales se enviarán al destinatario del regalo virtual de la forma en un correo HTML que mostrará lo mismo de la caja de la columna derecha, llamada "higift-view", y que describiré más adelante.

La estrucutra de la columna izquierda (higift-left) es la siguiente:

Nota: se debe generar una variable en php llamada $higift-type, en donde se almacenará si es una "tarjeta solidaria" o "corona de caridad", según lo que se haya seleccionado en los radio buttons

Nota 2: todos los campos de higift-left son obligatorios.

------------------------------------------------------------------------------------
Título: "Paso 1: tus datos"
Texto: "Indícanos la información sobre tí"

Campos (todos obligatorios.):
- Tu nombre (tipo texto, máximo 20 caracteres. Se guarda en el campo de Woocommerce que corresponderá al cliente que hace el pedido)
- Tu dirección de correo electrónico (se guarda como el correo de facturación de Woocommerce

-------------------------------------------------------------------------------------
Título: Paso 2: Contenido de la $higift-type

*Nombre del difunto (custom field: higift_other_name) - Importante: este campo solo se muestra cuando $higift_type es "corona de caridad". En caso contrario, no se imprime en el HTML.

*Mensaje: (custom field: higift_message): Es un campo de texto que soporta hasta 200 caracteres como máximo.

*Mensajes predefinidos: Este es un combobox cuyo contenido son 3 mensajes que el usuario puede seleccionar.

*Nombre de quien envía la corona/tarjeta (custom field: higift_sender_name): Texto, máximo 20 caracteres.

*Nombre de la persona o familia a quien se envía la corona/tarjeta (custom field: higift_to_name)

*Email al que se enviará la tarjeta: (custom field: higift_to_email)

*Dirección a la que se enviará la tarjeta física: (esto guarda el shipping_addres de woocommerce y lo configura más adelante en el pedido, solo para CORONAS DE CARIDAD. En el caso de las tarjetas de saludo, será un producto virtual, no habrá métodos de envío.)
-----------------------------------------------------------------------------------------
Título: Paso 3: Escoge un diseño (solo para productos variables).

Aquí se mostrarán cajas con imagenes, en filas de 3 elementos (cubren todo el ancho de la columna) en donde están las imágenes de las variaciones del producto. Si el producto es de tipo "simple", no se imprime esta sección.

Al hacer clic en cada una de estas imagenes, se configura como elegida una de las variantes del producto, lo que se debe almacenar también dentro de lo que se enviará al carrito de compras al presionar "añadir al carrito"
-----------------------------------------------------------------------------------------

En resumen, Coronas y tarjetas se diferenciarán en:
   El contenido de la variable $higift_type
   En el caso de las coronas, se muestra el campo "Nombre del difunto" y en el caso de las tarjetas, no se muestra. 
   Los diseños de tarjeta son variaciones del producto (cuando se configura como producto variable en el backend de Woocommerce), lo que se muestra en los thumbnails para elegir una variante, son los thumbnails de cada variante.

El formulario debe incorporar seguridad recaptcha v3 invisible. Cuando llegue el momento indícame en qué lugar debo incorporar el código que me entregará el servicio Google Recaptcha.

Finalmente, pondremos el botón de "añadir al carrito", el cual dejaremos grande, ancho y con el texto "Revisar Donación" (esto sin reescribir el botón en sí, sino solo cambiando su texto)

--------------------------------------------------------------------------------------------------------
COLUMNA DERECHA: HIGIFT-VIEW

En la columna derecha, hay una caja (div) con un máximo de tamaño de 496x708px. Esta se tendrá el ID "higift-view". Es importante que esta caja tenga definida la propiedad box sizing como "border-box" (y así hacia dentro). La utilizaremos para generar una vista previa de una tarjeta que se llenará con los elementos que se vayan escribiendo en el lado izquierdo, y será también lo que se enviará en el correo electrónico que se enviará hacia la dirección de email que definimos en "Email a quien se enviará la tarjeta" (higift_to_email), cuando el estado de la orden cambie a "completed"

1. Caja higift-view
La caja higift-view tiene en su interior dos cajas, una llamada "higift_view_top" y otra llamada "higift_view_bottom". 
Cada caja mide 496 pixeles de alto (es decir, una caja sobre otra, cada una es la mitad del alto de higift-view).

El fondo de higift-view es la imagen que corresponde a la variante a la cual se hace clic en las cajas con las imagenes de variante mencionadas anteriormente. Si el producto es variable, se seleccionará la primera variante y se pondrá la imagen corresponidente como fondo (css background-image) de esa caja.

Nota: para esto, claramente corresponde usar javascript. Lo que se hace es obtener la imagen de la variante a tamaño completo. Si no hay alguna función de Wordpress o Woocommerce que permita traer la URL de la imagen en tamaño completo, deberemos extraer el nombre del thumbnail y mediante una expresión regular, extraer la información que está antes de la extensión y que contiene las dimensiones del thumbnail. Por ejemplo, si la imagen del thumbnail de variante seleccionado es http://hogaritaliano.local/wp-content/uploads/2023/08/corona_corona-atardecer-150x150.jpg, la imagen será lo mismo excepto "-150x150.jpg".


1. higift_view_top: Esta caja no contiene nada. Solo es espacio a través del cual se podrá ver la imagen de fondo (background-img en css de higift-view), la cual irá cambiando conforme se seleccione una variante haciendo clic en en los thumbnails correspondientes, como explicamos más arriba.

2. higift-view_bottom: esta caja tiene un padding de 92 pixeles. Dentro de ella se imprimirá el contenido (a tiempo real, en la medida que el usuario escribe o borra en los campos del formulario que se encuentra en higift_left). Los campos se muestran de manera diferente en coronas y en tarjetas.

  En el caso de las coronas, el html generado debe contener los siguientes textos, cada uno en una línea distinta, centrados horizontal y verticalmente, utilizando todo el ancho de la caja.

   Hogar Italiano ha recibido una Corona de Caridad:
   En memoria de (higift_other_name)
   higift_message (el mensaje.)
   Enviada por: (higift_sender_name)
   Dirección (shipping_address)

  En el caso de las tarjetas, es más sencillo. los campos se muestran de la siguiente forma. El resto del texto lo indica el diseño. 

  (higift_to_name)
  (higift_message)
  (higift_sender_name)

----------------------------------------
ADD TO CART, CHECKOUT Y ENVÍO DE MAILS

Al presionar el botón "añadir al carrito", debemos asegurarnos que el carrito esté vacío. Solo se podrá hacer el pedido de un producto. Esto significa que debemos pasar automáticamente al checkout, sin darle opción al cliente de "revisar el carrito".

En la página del pedido, debemos también generar un template personalizado con dos columnas:
En la columna izquierda, todos los datos del pedido.
En la columna derecha, una pequeña vista previa de la tarjeta (usa el mismo html de higift_view. El css define que el tamaño máximo del higift_view es 496x708, déjalo de no más de 300 pixeles de alto, escalado proporcionalmente. Haz que la tipografía se escale, defínelas en términos que la tarjeta pueda cambiar de tamaño. Usa un único archivo CSS para higift_view que pueda ser utilizado para configurar la vista previa tanto en la página del product-single para coronas y tarjetas, como para esta vista previa y para el email que se enviará)

Una vez que el cliente haga el pago y termine el pedido en la pasarela de pago, la orden cambiará a "completed". En ese momento, debe enviarse el correo a la dirección de "higift_to_email":
- Para esto usaremos un hook en el momento en que se cambia el status del pedido.
- El correo que se envía a higift_to_email debe ser el mismo html generado (con la imagen de fondo de la variante correspondiente, o si se trataba de un producto simple, con la imagen de fondo del producto). 
- En este punto, quisiera explicarte que las coronas de caridad son una tarjeta virtual de saludo que además se envía impresa por correo, de manera que usaremos pasarelas de pago y métodos de envío que configuraré manualmente en woocommerce. Sin embargo, las tarjetas de saludo virtual son productos virtuales, solo se envía el correo.

- Por supuesto, el template de ese correo es diferente, en el sentido de que debe tener el CSS embebido.
- Las imagenes conservan la misma URL para mostrarse, es eficiente ya que las imagenes se encuentran almacenadas en  un CDN.
- El asunto del correo dependerá de si se trata de una corona de caridad o una tarjeta solidaria:
        - En el caso de las coronas de caridad, será "(higift_sender_name) le ha enviado una corona de caridad"
        - EN el caso de las tarjetas de saludo, será "(higift_sender_name) le ha enviado una tarjeta de saludo virtual".

Se debe enviar una copia al correo soporte@hogaritaliano.cl 


PLAN DE TRRABAJO:

El autor del plugin será: Victor Mellado / ChatGPT 4
La url del autor será: victormellado.cl
Nombre del plugin: higift



Tu tarea será guiarme paso a paso en la creación del plugin, generando código bien comentado, seguro y que incorpore todos lo hooks y elementos que hagan que sea un plugin válido para Wordpress/woocommerce.

Iniciaremos por crear la estructura de archivos para el plugin, en donde haya carpetas separadas para los templates, lo relacionado con el backend y frontend, estilos y javascript.

El plan de trabajo es el siguiente:Crearemos todo lo  necesario para personalizar el backend de woocommerce, luego lo relacionado con los templates, el add to cart y finalmente lo relacionado con el envío final del correo electrónico, incluyendo todos los pasos intermedios.

Esto ya lo hicimos anteriormente en un par de horas, pero era un theme. Ahora necesito que sea un plugin.


